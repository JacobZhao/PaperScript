\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{caption}
\usepackage{subcaption}
% \usepackage{subfigure}
\usepackage{color}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{enumerate}
\usepackage{multirow}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[utf8]{inputenc}
\usepackage[ruled]{algorithm2e}
\usepackage[colorinlistoftodos]{todonotes}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\title{Optimize Configuration For Mismatched PV System}
\author{\IEEEauthorblockN{Dafang Zhao, Fukuhito Ooshita, and Michiko Inoue}
%Email: 
\IEEEauthorblockA{Nara Institute of Science and Technology, Japan\\
Email:   \{zhao.dafang.yu7, f-ooshita, kounoe\}@is.naist.jp}}
\maketitle

\begin{abstract}
Power generation efficiency of Photovoltaic(PV) system are significantly affected by partial shading and solar cell damage. This efficiency loss caused by turning on bypass diode of PV panels, which we called mismatch loss. By using some reconfiguration technology to reconfigure electrical series or parallel connection can reduce the mismatch loss and maximize power generation. Recently, an efficient reconfiguration method is proposed. This method applies precise power simulations based on a list of configuration candidates. However, some of the configuration candidates are not be able to realized and this method does not show any systematic way to identify such feasibility. Thus, in this paper we propose a very fast algorithm to check feasibility and reduce wiring complexity.
\end{abstract}

% \begin{IEEEkeywords}
% component, formatting, style, styling, insert
% \end{IEEEkeywords}

\section{Introduction}
With fossil depleting and the pollution of the environment becomes more serious. Green and renewable energy have become necessary for a sustainable society and environment. Photovoltaic(PV) receive significant attention since it has unlimited energy and can be easily scaled up. However, due to the nature of photovoltaic cell structure, PV arrays are sensitive to partial shading and PV cell fault or aging. That means when PV cells or modules experience different irradiance or do not uniformly generate power, the PV array is mismatched and unable to efficiently generate power. Additionally, when PV array under mismatch condition it will accelerate aging and heating for PV cells. That will cause a short circuit of PV array for further damaging. In order to prevent damaging on PV array and maximize power generation many reconfiguration method been proposed.

A PV panel level reconfiguration using genetic algorithm (GA) is proposed in \cite{carotenuto2015evolutionary}. Though it can give a new configuration, but computing cost is significant and algorithm cannot generate the best configuration precisely. The work in \cite{nguyen2008adaptive} proposed a switch matrix to reconfigure shadowed PV array, but it can not be able to apply on large size PV array. Paper \cite{storey2013improved} using "irradiance level equalization" method to dynamic reconfigure PV array and improve power generation efficiency over 10\%. The work in \cite{malathy2017reconfiguration} employed Irradiation equivalence method by using swathing matrix relocate PV panels. At PV module level, paper \cite{wang2014architecture} proposed a dynamic programming algorithm to adaptively produce near-optimal reconfiguration, the work in \cite{storey2014optimized} proposed a method for dynamic reconfigure PV array based on string-configured topology.
Fig.\ref{compare} shows the difference of shadowed PV array between only using Global maximum point tracking method and using reconfiguration strategy.
% finding global maximum point tracking (without reconfiguration) 
% and reconfigured PV array.
It puts into evidence that after reconfiguration shadowed PV array be able to generate more power and Pâ€”V curve has only one peak which is very useful for maximum point tracking devices.

To give the reconfiguration more expeditiously, the mathematical searching algorithm needs to be developed instead of sample exhaustive searching algorithm. Reference \cite{faldella1991architectural} given a method based on the tabular searching algorithm, it performing well on small size PV array, but it is hard to apply on a large scale array. Paper \cite{iraji2017optimisation} proposed an algorithm based on particle swarm optimisation to find switch matrix topology. 

But the reference \cite{carotenuto2015evolutionary} -\cite{iraji2017optimisation} given reconfiguration methods either force on uniformly distributed shadow or using GA and exhaustive searching algorithm. Reference \cite{orozco2016optimized} developed a fast reconfiguration strategy by using approximated values of MPP current and voltage to generate configuration candidates. In this strategy, first list and calculate configuration candidates by a fast estimation method in \cite{orozco2015fast}, and for each candidate, precise power simulation are applied. However, when the size of PV array are extremely large, it's impossible to do power simulation for each configuration candidate, and some configuration candidates might not be feasible, this is, it is impossible to realize a configuration designed by given PV panels.

In this paper, we propose an algorithm to identify feasibility based on the configuration candidates from \cite{orozco2016optimized} and a new connection topology to increase system flexibility without loss too much accuracy. The layout of reaming sections as below. Section \ref{Sec2} illustrate the model setting of PV array and etc.. Section \ref{Sec3} give the details of configuration candidates from \cite{orozco2016optimized}. Section\ref{Sec4} is the definition of feasibility. Section \ref{Sec5} and \ref{Sec6} give the details of algorithm and evaluation. Section \ref{Sec7} is the simulation result. Conclusions are provided in the last section.
% By reconfigure electrical connection of mismatched PV array can increase power generation efficiency. 
\begin{figure}
    \centering
    \includegraphics[width=0.8\linewidth]{compare.eps}
    \caption{Maximum Power generation difference between before and after reconfiguration}
    \label{compare}
\end{figure}

\section{Photovoltaic array}\label{Sec2}
In this paper we use the following model of PV array, module, string and panel as showed in Fig.\ref{model}. In general, a PV array is a combination of multiple PV panels. Several series-connected PV panels in formed of a string. And several parallel connected string in formed of PV array. This is typical S-P network PV array. A PV panel usually formed by three series-connected PV module which in formed of several series-connected PV cells. For each PV module a bypass diode is connected in parallel for reversing the reverse current. PV cells in a PV panel may have different conditions (irradiance or fault) and hence have different  upper limits for their generated currents. Therefore, as shown in Fig.\ref{one_panel} for lower control voltage, only PV cells can generate high currents be able to work and other PV cells don't generate current with their bypass diode turned on. Fig.\ref{ser-par} show I-V character for two series and parallel connected PV panels. The series-connection structure accepts a wider range of control voltage and parallel-connection structure can generate higher current.
\begin{figure}
    \centering
    \includegraphics[width=0.8\linewidth]{module.png}
    \caption{PV array, string, module and panel}
    \label{model}
\end{figure}

When understanding the I-V characteristics of different structure of PV panels, by using the algorithm in \cite{carotenuto2014online} we can find the I-V curves of panels and (near) MPPs, short circuit current, open circuit voltage of each panel in mismatch condition. These values form a fingerprint of connection.
\begin{figure}
     \centering
     \begin{subfigure}[b]{0.8\linewidth}
         \centering
         \includegraphics[width=\linewidth]{one-panel.eps}
         \caption{I-V characteristics on different control voltage}
         \label{one_panel}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.8\linewidth}
         \centering
         \includegraphics[width=\linewidth]{ser-par.eps}
         \caption{Series and parallel connection I-V character}
         \label{ser-par}
     \end{subfigure}
        \caption{PV Panel I-V characteristic}
        \label{fig:three graphs}
\end{figure}
\section{Related works}\label{Sec3}
Orozco-Guierrez et al. proposed a fast reconfiguration algorithm for mismatched PV arrays \cite{orozco2016optimized}, where the online monitoring \cite{carotenuto2014online} and power estimation \cite{orozco2015fast} are utilized. For the method in \cite{orozco2016optimized}, first, close values will be approximated and then possible combinations of reconfiguration are enumerated. For each configuration candidates their generate power value are estimated by \cite{orozco2015fast} along with careful estimation of possible errors. This method provided a simplified feasibility check, for all possible configuration the representative value with some error rate \textit{err}. Select configuration candidates with \textit{err} from the largest estimation value.

This method has given configuration candidates designate the number of strings, current value of each string and the number of modules which not been bypassed of each string. Besides, the number of active modules are common for each string based on that each PV string are connected in parallel. However, for some configuration candidates, we may not be able to find such combination that fit the requirement. We find out the simple feasibility check based on the number of active PV modules for each representative current values in \cite{orozco2016optimized} is optimistic and does not always identify the infeasible case.
\section{Feasibility}\label{Sec4}
To execute a power simulation for a PV array. We need to assign panels into different location to realize the candidate configuration. The definition of feasibility is in Equation \ref{feasibility}. When the number of working modules in a string ($M_S$) are less than the number of working module per-string ($Q_M$), this configuration is infeasible.
\begin{equation}
    \left\{\begin{matrix}
        M_S < Q_{M} & & \text{Infeasible}\\ 
        M_S \geqslant Q_{M} & & \text{Feasible} 
    \end{matrix}\right.
    \label{feasibility}
\end{equation}

For example, An 3X3 PV array formed by 9 PV panels. The number of modules that are able to work at current value for each string as showed in Table \ref{not_feasible}.The dot in each block in form of a PV module. As the number of modules and the panel they belong to, it is straight forward that panel P1 for any current value it have at least 2 modules can work. Instead of panel P9 only have 1 module can work at 0.5A.
One configuration requires 6 modules working for each string at 0.5A, 0.5A and 3A($Q_M = 6$). According to Table \ref{not_feasible} there isn't any combination for such configuration. Of course we can compute it by using exhaustive searching. However it is time-consuming. So we need an algorithm to efficiently identify feasibility for each configuration candidates.

\begin{table}[htbp]
    \caption{Infeasible Example}
    \begin{center}
    \begin{tabular}{c|c|c|c|c|c|c|c|c|c}
    \hline\hline
             & P1 & P2  & P3  & P4 & P5 & P6  & P7  & P8  & P9  \\ \hline
         0.5A & ***& *** & *   & *  & ***& **  & *   & *** & * \\ \hline
         1.5A & ***& *** & *   & *  & ***&     & *   &     &   \\ \hline
         3A   & ** & **  & *   & *  & ** &     &     &     &   \\\hline \hline
    \end{tabular}
    \label{not_feasible}
    \end{center}
\end{table}
\section{An algorithm to identify feasibility}\label{Sec5}
In this section we proposed an algorithm to identify feasibility.
\subsection{Input And Output Of Algorithm}\label{Sec5_1}
The input of algorithm is the information of PV array and Configuration candidates. The information of PV array contains a set of panels and the number of working modules in each panel for each current values. Table \ref{Info_Array} shows the information of a PV panel from Table \ref{not_feasible} for configuration \{0.5A, 0.5A, 3A, $Q_M = 6$ \}.
\begin{table}[htbp]
    \caption{Information of PV Array}
    \begin{center}
    \begin{tabular}{c|c|c|c|c|c|c|c|c|c}
    \hline\hline
             & P1 & P2  & P3  & P4 & P5 & P6  & P7  & P8  & P9  \\ \hline
         String1-0.5A & 3& 3 & 1   & 1  & 3& 2  & 1   & 3 & 1 \\ \hline
         String2-0.5A & 3& 3 & 1   & 1  & 3& 2  & 1   & 3 & 1  \\ \hline
         String3-3A   & 2 & 2  & 1   & 1  & 2 & 0  &0   &0  &0  \\\hline \hline
    \end{tabular}
    \label{Info_Array}
    \end{center}
\end{table}
It terms that for panel P2, 3 modules are able to work on String1 or String2 and 2 modules are able to work on String3. Due to one panel can only connected to single string. So the output of algorithm is the feasibility answer for a configuration. That is, the algorithm determines whether there exists an assignment of panels to strings that realizes the configuration required.

\subsection{Algorithm}

Let the $S$ for the number of PV strings and $P$ be the number of PV panels, $M_{(i,p)}$ is the number of modules on panel $p$ at current value $i$. For each panel we consider the different vector $Loss[p,k] = M_{(i_{k-1},p)}-M_{(i_{k},p)} ,(k \leq S)$. This vector means if we use panel $p$ on current $k$  it will loss $Loss[p,k]$ working modules in current $k-1$. Without loss of generality, for each panel $p$, $Loss^*[p] = ( Loss[p,k_1], Loss[p,k_2],..., Loss[p,k_S] )$ and $Loss^*[p_i] \leq Loss^*[p_j]$ holds for any $i \leq j$. After sorting all panels in lexicographic order by vector $Loss^*[p]$, we will have a order for arranging panels in different location.

To assign panels in right location, following steps are required.
\begin{enumerate}[(1)]
\item Selecting panel from sorted panels until selected contain enough PV modules working at the highest desired current value.
\item Remove selected panels which don't have PV modules working at the highest desired current value for further more selection.
\item In selected panels, try to find a combination that provided exact number of modules working at the highest desired current value.\label{find_exact}
\item Swap selected panels to find a combination with minimum number of panels. This SWAP will follow several priorities.\label{swap}
\item If SWAP approved, step \ref{swap} will be repeated till number of panels are minimized.
\item Otherwise, none of SWAP will be approved. Evaluate selected panels with feasibility requirement in \ref{Sec4} equation (\ref{feasibility}).
\item If there remain any un-selected panel, as them to different PV strings that balance the string length.
\end{enumerate}

We explain step (\ref{find_exact}) and (\ref{swap}) that finding a local optimized combination of a desired current value. To do this, we begin with sorting panels by vector $Loss^*[p]$. That will let a panel with minimum module losses be the first one in a string with highest current value. When $Loss^*[p_a] = Loss^*[p_b]$ which means panel $a$ and panel $b$'s module losses are same and they are in same loss level ($LV$). By using vector $LV$ we can divide selected panels into different groups.

To get exact number of working modules, we start to search panels form last loss level to first loss level. In each $LV$ remove the panel $x$ which $M_{(j,x)} \leq Q_M - \sum (M_{(j,\textup{Selected Panels})})$. This step will cut the number of panels and increase flexibility.

\begin{table}[htbp]
\caption{SWAP Example}
\begin{center}
\begin{tabular}{c|ccccc|cc}\hline \hline
                               & \multicolumn{5}{c|}{Selected Panels} & \multicolumn{2}{c}{Swap Panels} \\
                               & $P1$    & $P2$   & $P3$    & $P4$    & $P5$   & $P6$            & $P7$             \\ \hline
High                           & 1     & 1     & 1     & 1     & 2    & 2              & 2              \\ \hline
Low                            & 1     & 1     & 1     & 2     & 3    & 3              & 3              \\ \hline
$Loss^*[p]$ & 0     & 0     & 0     & 1     & 1    & 1              & 1             
\end{tabular}
\end{center}
\label{table_swap}
\end{table}

For swapping panels, panels with same $LV$ as selected panels can be swapped. In order to not loss flexibility, swapped panles' $Loss^*[p]$ should less than unswap panels'. For example as Table \ref{table_swap}, panel $P1-P5$ are selected panels. Panel $P6$ and $P7$ have the same $Loss^*[p]$ vector as $P5$, so they are able to swap. Due to $P1$ and $P2$'s $Loss^*[p]$ are less than $P6$'s, we can not swap them. On the other hand, we can swap panel $P1$ and $P4$ with $P6$. Keeping the same module losses and further reduce the number of panels.  Pseudo codes are given below to give details to summarize the process of proposed algorithm.

\begin{algorithm}
\caption{Sort panel by lexicographic order}
\LinesNumbered
\SetKwInOut{Input}{Input}  
\Input{\textit{$M_{(i,p)}$}: The number of modules in panel \textit{p} at current \textit{i};
  \textit{P}: Number of panels; \textit{S}: Number of strings;
  \textit{$Q_M$}: The minimum number of modules for each string;}
\SetKwInOut{Output}{Output}
\Output{Feasibility Result;\\
        Conf: Configuration Result;}
\For{k = 1 to S-1, \textup{\textbf{each}} panel $p$}{$Loss[p,k] = M_{(i_{S-k},p)}-M_{(i_{S-k+1},p)}$}
PSet = $\{p_1, p_2,...,p_P\}$\\
\For{j = S to 1}
    {n = 1;\\
     \For{\textup{\textbf{each}} p $\in$ PSet}
        {$Loss^*[p] = (Loss[p,S-j+1], Loss[p,S-j+2],..., Loss[p,S])$\\
        Let $\alpha_1, \alpha_2,..., \alpha_{|PSet|}$ be indices such that $Loss^*[p_{\alpha i}] \leq Loss^*[p_{\alpha j}]$ holds for $ \textup{\textbf{any}}$ i $\leq$ j\\
        \tcc{Sort Panels in lexicographical order by \textit{Loss}}}
     \While{\textup{SUM} = $\sum_{k=1}^{n} M_{(i_j,\alpha_k)} < Q_M$}
        {\If{n == $PSet$}
            {\textup{\textbf{return :}} Feasibility = NO}n++;\\}
        $TempConf$ = \{ $p_{\alpha_1}$, $p_{\alpha_2}$, $p_{\alpha_3}$,..., $p_{\alpha_n}$ \};\\
    \ForAll{panels in $TempConf$}
        {remove panels which $M_{(j,\alpha)} == 0$}
    %  \For{m = 1 to n}
    %     {\If{$M_{(j,\alpha_m)} == 0$}
    %         {$TempConf$ = $TempConf$ -\{$p_{\alpha_m}$\}}}
    %  \eIf{SUM == $Q_M$ \textup{or} j == 1}
    %     {Conf[j] = $TempConf$}
    %     {Over = SUM - $Q_M$;\\\textup{\textbf{Do} Algorithm 2}}
        Over = SUM - $Q_M$;\\\textup{\textbf{Do} Algorithm 2}\\
        % Conf[j] = $TempConf$\\
        $PSet$ = $PSet$ - Conf[j];\\
    }
    \textup{\textbf{return :}} Feasibility = YES
\end{algorithm}

\begin{algorithm}
    \caption{find exact \# of modules}
    \LinesNumbered
    \KwIn{$TempConf$, n, $Loss^*[p]$,Over}
    \KwOut{Conf[j]}
    $i$ = $h$ = 1; $LV[h]$ = \{$p_{\alpha_1}$\};\\
    \While{i $\neq$ $\left|PSet\right|$}
        {i++;\\
        \uIf{$Loss^*[p_{\alpha_i}]$ == $Loss^*[p_{\alpha_{i-1}}]$}
            {$LV[h] = LV[h]$ $\cup$ \{$p_{\alpha_i}$\}\\
            \textup{\textbf{continue;}}}
        \uElseIf{i $>$ n}
            {\textup{\textbf{break;}}}
        \Else{h++;\\$LV[h]$ = \{$p_{\alpha_i}$\}}
    }
    \While{h$\neq$0}
        {\eIf{Over == 0}
            {\textbf{\textup{break;}}}
        {L=$\left|\{p_i \in LV^*[h^{'}]\mid h^{'} \leq h-1 \}\right|$\\
        $l^{*} = \left|\{p_i \in LV^*[h]\mid M_{(j,\alpha_i)} \leq Over \}\right|$\\
        Let $l$ be the minimum index $l^{'}$ such that $\sum^{l^{*}}_{t=l^{'}}M_{(j,\alpha_{L+t})}\leq Over$\\
        $Over = Over - \sum^{l^{*}}_{t=l^{'}}M_{(j,\alpha_{L+t})}$;\\
        $TempConf$ = $TempConf$ - $\{p_{L+l}, p_{L+l+1},..., p_{L+l^*}\}$;\\
        $h- -$;}
    }
    $U = \{p_{\alpha_{1}}, p_{\alpha_{2}},..., p_{\alpha_{i-1}}\}$;\\
    $N = U-TempConf$;\\
    \Repeat{x==$\left|N\right|$}
        {Let $\beta_1, \beta_2, \beta_3,...,\beta_{\left|TempConf\right|}$ be new indices of $TempConf$;\\
        Let $\gamma_1, \gamma_2, \gamma_3,...,\gamma_{\left|N\right|}$ be new indices of $N$;\\
        \For{x = 1 to $\left|N\right|$}
            {\ForAll{$p_\beta$ in $TempConf$}
                {\uIf{$\sum M_{(j,\beta}$==$M_{(j,\gamma_x)}$}
                    {$TempConf = TempConf - \{p_{\beta}\}+\{p_{\gamma_x}\}$;\\
            % $N^* = \left|N\right|$\\
            $N = N - \{p_{\gamma_x}\}$;\\
            \textbf{\textup{Continue;}}\\}}}
        }
\end{algorithm}
\subsection{Evaluation}
Although the pilot example refers to three strings only, the extension of the method to any number of parallel connected strings is the same.

To evaluate the performance of proposed algorithm, we compare the result with exhaustive searching algorithm for 300 random shadow distributed PV array. For each PV array, contains {\color{red} \textbf{how many - how many}} PV panels connected into {\color{red} \textbf{how many - how many}} PV strings. For each PV panels, it will have {\color{red}{how many - how many}} working current value.

The computational time required for finding optimal configuration and accuracy of feasibility judgment in the proposed algorithm and exhaustive search algorithm are compared in Table \ref{result_compare}. As shown in Table \ref{result_compare}, proposed algorithm achieved less computing time compare with exhaustive search algorithm and with high accuracy.  
\section{Simulation}\label{Sec6}
In this section, we consider using 3 different size PV array, which are 3 $\times$ 4 array, 60 $\times$ 4 array and 40 $\times$ 15 array. The whole process though SPICE simulation with the configuration result by proposed algorithm. The PV cell's parameters are shown in Table \ref{PV_cell_par}.

\begin{table}[]
\caption{PV Cell Parameters}
\begin{center}
\begin{tabular}{c|c}
\hline \hline
Parameter             & Value  \\ \hline
Short-Circuit Current & 0.66A  \\
MPP-Current           & 0.58A  \\
Open-Circuit Voltage  & 280V   \\
MPP-Voltage           & 215V  \\
Max Power Output      & 124.7W 
\end{tabular}
\end{center}
\label{PV_cell_par}
\end{table}
\subsection{3 $\times$ 4 Array}
In a 3 $\times$ 4 array, there are 12 panels connected in parallel for 4 strings, for each string contains 3 PV panels. The shadow conditions for PV array are not uniformly, as shown in Fig. \ref{shadow_3x4_a}. Without reconfiguration, PV array output I-V characteristic as shown in Fig. \ref{shadow_3x4_b}. The global MPP as {\color{red}{how many Watt}} on {\color{red}{how many voltage}}. After proposed algorithm based reconfiguration, this PV array achieved {\color{red}{how many Watt}} on {\color{red}{how many voltage}} for global MPP. The output power has increased by {\color{red}{how many \%}}
\subsection{60 $\times$ 4 Array}
For medium size 60 $\times$ 4 array, on standard test condition the power output are {\color{red}{how many KW}} without any shadow. Fig. \ref{shadow_60x4_a} presents the shadow distribution amount the PV array which power output are {\color{red}{how may KW}}. After reconfiguration, panel arrangement as illustrated in Fig. \ref{shadow_60x4_b}. With reconfiguration, power generation increased by {\color{red}{how many \%}}.
\subsection{40 $\times$ 15 Array}
As a large scale PV array. Although the algorithm proposed in \cite{orozco2016optimized} are hard to converge when the configuration candidates are widely distributed. The algorithm we proposed still calculate the feasible configuration result very fast. {\color{red}{60}} configuration candidates though the feasibility judgment algorithm in 269.6s with {\color{red}{20}} feasible configuration as shown in Table \ref{shadow_40x15_table}.
\section{Conclusions}\label{Sec7}

\section*{Acknowledgment}


% \section*{References}

\renewcommand\refname{Reference}
\bibliographystyle{ieeetr}
\bibliography{reference}

\end{document}
